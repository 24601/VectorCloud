{% extends "layout.html" %}
{% block content %}
    <div class="container">
      <div class="content-section">
          {% for command in command_list %}
            <p>
              >> {{ command }}
            </p>
            <p></p>
          {% endfor %}
          <form method="POST" action="/home">
              {{ form.hidden_tag() }}
              <fieldset class="form-group">
                  <legend class="border-bottom border-dark text-center"><b>Vector Commands</b>
                    <img align="right"
                         class="legend-icon"
                         src="{{ url_for('static', filename='icons/info.svg') }}"
                         width="24px"
                         height="24px"
                         data-toggle="popover"
                         data-placement="left"
                         title="Robot Commands <a href='#' class='close' data-dismiss='alert'>&times;</a>"
                         data-html="true"
                         data-content="
                    <p><b>Enter a robot. command: </b>In this command bar you can enter python code with the condition of: </p>
                    <p><code>with anki_vector.Robot(args.serial) as robot:</code></p>
                    <p><b>Sample Commands: </b></p>
                    <p><code>robot.get_version_state()</code></p>
                    <p><code>robot.get_battery_state()</code></p>
                    <p><code>robot.behavior.drive_off_charger()</code></p>
                    <p><code>robot.behavior.drive_on_charger()</code></p>
                    <p><code>robot.say_text('Hello World')</code></p>
                    <p><code>robot.behavior.set_eye_color(hue=0.0, saturation=0.0)</code></p>
                    <p><code>time.sleep(10)</code></p>
                    <p>Refer to the API section of the docs in the SDK folder for a full list of commands.</p>
                    <p><b>Database Commands: </b>The command bar sends python code to the running application, so a side effect is that
                    we can send database queries from the bar as well. Full documentation on the database is coming, but some common database queries would be:</p>
                    <p><b>Clear the user table:</b></p>
                    <p><code>db.session.query(User).delete()</code></p>
                    <p>Note: This will delete the user account and redirect you to the register screen</p>
                    <p><b>Clear the applications table:</b></p>
                    <p><code>db.session.query(Application).delete()</code></p>
                    <p><code>db.session.query(AppSupport).delete()</code></p>
                    <p>Note: This will clear the application table and support files entries in the database, but will not delete the files from the folders</p>
                    ">
                  </legend>
                  <div class="row image-container">
                    <div class="column search-bar">
                          <div onsubmit="loading();">
                            {{ form.command(autocomplete="off",
                                            class="form-control form-control-lg",
                                            placeholder="Enter a command..") }}
                          </div>
                    </div>
                    <div class="column search-icon">
                      {{ form.submit(class="btn btn-dark") }}
                    </div>
                  </div>
              </fieldset>
          </form>
          <div class="image-container row">
            {% if command_list %}
                <a href="{{ url_for('main.execute_commands') }}">
                <img class="store-icon column mb-4" src="{{ url_for('static', filename='icons/play.svg') }}" onclick="loading();" width="32px" height="32px" data-toggle="tooltip" data-placement="top" title="Execute Commands">
                </a>
                <a href="{{ url_for('main.clear_commands') }}">
                <img class="store-icon column mb-4" src="{{ url_for('static', filename='icons/trash.svg') }}" width="32px" height="32px" data-toggle="tooltip" data-placement="top" title="Clear Commands">
                </a>
            {% endif %}
          </div>
      </div>
    </div>
    <div class="text-center">
      <a href="{{ url_for('application_store.app_store') }}">
      <img class="store-icon" align="right" src="{{ url_for('static', filename='icons/package-grey.svg') }}" width="24px" height="24px" data-toggle="tooltip" data-placement="top" title="Add Applications">
      </a>
    </div>
    {% block view %}{% endblock %}
    <div>
      <legend class="text-left border-dark mb-4">Applications</legend>
    </div>
    {% if app_list %}
    <form method="POST" action="/home">
        {{ form.hidden_tag() }}
        <fieldset class="form-group">
          <div class="content-section">
            <div class="row image-container">
              <div class="form-group column search-bar">
                  {% if search_form.search.errors %}
                      {{ search_form.search(class="form-control form-control-lg is-invalid") }}
                      <div class="invalid-feedback">
                          {% for error in search_form.search.errors %}
                              <span>{{ error }}</span>
                          {% endfor %}
                      </div>
                  {% else %}
                    <div onsubmit="loading();">
                      {{ search_form.search(autocomplete="off", class="form-control form-control-lg") }}
                    </div>
                  {% endif %}
              </div>
              <div class="column search-icon">
                {{ search_form.go(class="btn btn-dark") }}
              </div>
            </div>
            <div class="row image-container">
              <div class="form-check column">
                  {{ search_form.by_name(class="form-check-input") }}
                  {{ search_form.by_name.label(class="form-check-label") }}
              </div>
              <div class="form-check column">
                  {{ search_form.by_description(class="form-check-input") }}
                  {{ search_form.by_description.label(class="form-check-label") }}
              </div>
              <div class="form-check column" >
                  {{ search_form.by_author(class="form-check-input") }}
                  {{ search_form.by_author.label(class="form-check-label") }}
              </div>
            </div>
            {% if search_term %}
            <p></p>
            <div class="border-bottom border-dark grey-text">
              <b>Searching: </b>{{ search_term }} | {{ num_results }} results
              <a href="{{ url_for('main.home') }}">
              <img class="store-icon" align="right" src="{{ url_for('static', filename='icons/close.svg') }}" width="16px" height="16px">
              </a>
            </div>
            {% endif %}
          </div>
        </fieldset>
    </form>
    {% endif %}
    {% if not app_list %}
      <p></p>
      <div class="text-center">
        <a href="{{ url_for('application_store.app_store') }}">
        <img class="mb-4" src="{{ url_for('static', filename='icons/package-grey.svg') }}" width="128px" height="128px" data-toggle="tooltip" data-placement="top" title="App Store">
        </a>
        <div class="grey-text">
          <p>No applications installed. Go to the app store or upload a local package.</p>
        </div>
      </div>
    {% else %}
      <div class="content-section">
          {% for app in app_list %}
          <div class="border-bottom border-dark">
            <div class="image-container">

              <a href="{{ url_for('application_system.run_script', script_hex_id=app.hex_id) }}" onclick="loading();">
              <img class="store-icon-main" src="{{ url_for('static', filename='app_icons/' + app.icon) }}" width="48px" height="48px">
              <b>{{ app.script_name }}</b>
              </a>

              {% if app.pid != None %}
                <a href="{{ url_for('application_system.kill_process', pid=app.pid) }}">
                <img class="list-view-spinner" align="right" src="{{ url_for('static', filename='icons/running_in_bkrd.svg') }}" data-toggle="tooltip" data-placement="top" title="Process Running. Click here to kill.">
                </a>
              {% endif %}

              <a data-toggle="collapse" href="#{{ app.script_name }}" role="button" aria-expanded="false" aria-controls="collapseExample">
                <img class="list-view-spinner"
                     src="{{ url_for('static', filename='icons/arrow-down.svg') }}"
                     width="24px" height="24px">
              </a>
            </div>
            <div class="collapse" id="{{ app.script_name }}">
              <div class="border-top border-dark mt-4"></div>
              <div class="row mt-4 image-container">
                <div class="column store-icon-main">
                  <a href="{{ url_for('application_system.edit_application', script_id=app.id) }}">
                  <img class="" src="{{ url_for('static', filename='icons/edit.svg') }}" width="24px" height="24px" data-toggle="tooltip" data-placement="top" title="Edit">
                  </a>
                </div>
                <div class="column store-icon-main">
                  <a href="{{ url_for('application_store.export_application', script_id=app.id) }}">
                  <img src="{{ url_for('static', filename='icons/download.svg') }}" width="24px" height="24px" data-toggle="tooltip" data-placement="top" title="Download Package">
                  </a>
                </div>
                <div class="column store-icon-main">
                  <a href="{{ url_for('application_system.delete_application', script_id=app.id) }}">
                  <img align="left" src="{{ url_for('static', filename='icons/trash.svg') }}" width="24px" height="24px" data-toggle="tooltip" data-placement="top" title="Delete">
                  </a>
                </div>
                <div class="column store-icon-main" data-toggle="tooltip" data-placement="top" title="Application Settings">
                  <a href="{{ url_for('application_system.edit_app_settings_file', hex_id=app.hex_id) }}">
                  <img src="{{ url_for('static', filename='icons/settings.svg') }}" width="24px" height="24px">
                  </a>
                </div>
              </div>
              <div class="border-top border-dark mt-4"></div>
              <div class="grey-text-md mt-2 text-center list-info">
                <p><b><u>Author</u></b></p>
                <p>{{ app.author }}</p>
                <p><b><u>Website</u></b></p>
                <p>{{ app.website }}</p>
                <p><b><u>Description</u></b></p>
                <p>{{ app.description }}</p>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

{% endblock content %}
